{% extends "base/base.html" %}

{% block site_title %}
    {{ request.user.username }}
{% endblock %}

{% block content %}

    <div class="wrapper"> 

        <div class="header">
        </div>

        {% include "base/navigation_user.html" %}

        <div class="content">

            <div class="workplace">

                <div class="page-header">
                    <h1>Добро пожаловать <small>111000</small></h1>
                </div>                  
                
                <div class="row">

                    <div class="col-md-12">
                        <div class="head clearfix">
                            <h1>История оплаты по месячно за <b>2025</b> год:</h1>
                        </div>
                        <div class="block">
                            <table cellpadding="0" cellspacing="0" width="100%" class="table listUsers">
                                <tbody>                                
                                    <tr>                                    
                                        <td width="60">
                                            <h5>1</h5>
                                        </td>
                                        <td>
                                            <a href="#" class="user">ЯНВАРЬ</a>
                                            <p class="about" style="color: green;">
                                                <span class="glyphicon glyphicon-check"></span> Оплачено 750 сомов <br>
                                            </p>
                                        </td>
                                        <td width="70">
                                            <!-- <button class="btn btn-primary" type="button">Посмотреть чек оплаты</button> -->
                                            <button class="btn btn-primary" type="button" data-toggle="modal" data-target="#dModal">
                                                Посмотреть чек оплаты
                                            </button>
                                        </td>
                                        <div class="modal fade" id="dModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <button type="button" class="close" data-dismiss="modal">
                                                            <span aria-hidden="true">×</span><span class="sr-only">Close</span>
                                                        </button>                        
                                                        <h4 id="myModalLabel">Чек оплаты</h4>
                                                    </div>
                                                    <div class="modal-body">
                                                        <iframe src="check.pdf" width="100%" height="400px"></iframe>
                                                    </div>                    
                                                </div>
                                            </div>
                                        </div>
                                    </tr>   
                                    <tr>                                    
                                        <td width="60">
                                            <h5>2</h5>
                                        </td>
                                        <td style="width: 1px;">
                                            <a href="#" class="user">ФЕВРАЛЬ</a>
                                            <p class="about" style="color: orange;">
                                                <span class="glyphicon glyphicon-hourglass"></span> Ожидание оплаты 750 сомов<br>
                                            </p>
                                        </td>
                                        <td width="70">
                                            <form action="" id="postCheckPaySend" enctype="multipart/form-data">
                                                <label for="check_pay">Выбрать чек</label>
                                                <input type="file" name="chech_pay">
                                                <button type="submit">Отправить</button>
                                                
                                            </form>
                                            <span id="loader" style="display: none;">
                                                <img src="img/loaders/loader.gif" title="loader.gif">
                                            </span>

                                            <script>
                                                document.getElementById('postCheckPaySend').addEventListener('submit', async function (event) {
                                                    event.preventDefault(); // предотвращаем стандартную отправку формы

                                                    const form = event.target;
                                                    const formData = new FormData(form);
                                                    const loader = document.getElementById('loader');
                                                    const formObj = document.getElementById('postCheckPaySend'); 

                                                    loader.style.display = 'inline-block'; // показать лоадер
                                                    formObj.style.display = 'none';

                                                    try {
                                                        const response = await fetch('http://127.0.0.1:8000/upload', {
                                                            method: 'POST',
                                                            body: formData
                                                        });

                                                        if (!response.ok) {
                                                            throw new Error('Ошибка при загрузке файла');
                                                        }

                                                        const result = await response.json();
                                                        console.log('Успешно отправлено:', result);

                                                        notify_s('Успешно', 'Файл успешно загружен');
                                                        setTimeout(() => {
                                                            location.reload();
                                                        }, 1000);

                                                    } catch (error) {
                                                        console.error('Ошибка:', error);

                                                        notify_e('Ошибка', 'Не удалось загрузить файл');
                                                        formObj.style.display = 'inline-block';
                                                    } finally {
                                                        loader.style.display = 'none'; // скрыть лоадер в любом случае
                                                    }
                                                });
                                            </script>
                                        </td>
                                    </tr>                              
                                    <tr>                                    
                                        <td width="60">
                                            <h5>3</h5>
                                        </td>
                                        <td style="width: 1px;">
                                            <a href="#" class="user">МАРТ</a>
                                            <p class="about" style="color: orange;">
                                                <span class="glyphicon glyphicon-hourglass"></span> Ожидание оплаты <br>
                                            </p>
                                        </td>
                                        <td width="70">
                                            <span><img src="img/loaders/loader.gif" title="loader.gif"></span>
                                        </td>
                                    </tr> 
                                    <tr>                                    
                                        <td width="60">
                                            <a href="#"><img src="img/users/aqvatarius_s.jpg" width="42" class="img-thumbnail"></a>
                                        </td>
                                        <td>
                                            <a href="#" class="user">Aqvatarius</a>
                                            <p class="about">
                                                <span class="glyphicon glyphicon-envelope"></span> aqvatarius@domain.com <br>
                                            </p>
                                        </td>
                                        <td>
                                            <p class="about">
                                                <a href="#"><span class="glyphicon glyphicon-pencil"></span></a> 
                                                <a href="#"><span class="glyphicon glyphicon-envelope"></span></a> 
                                                <a href="#"><span class="glyphicon glyphicon-remove"></span></a>                                        
                                            </p>
                                        </td>
                                    </tr>
                                    <tr>                                    
                                        <td width="60">
                                            <a href="#"><img src="img/users/aqvatarius_s.jpg" width="42" class="img-thumbnail"></a>
                                        </td>
                                        <td>
                                            <a href="#" class="user">Aqvatarius</a>
                                            <p class="about">
                                                <span class="glyphicon glyphicon-envelope"></span> aqvatarius@domain.com <br>
                                            </p>
                                        </td>
                                        <td>
                                            <p class="about">
                                                <a href="#"><span class="glyphicon glyphicon-pencil"></span></a> 
                                                <a href="#"><span class="glyphicon glyphicon-envelope"></span></a> 
                                                <a href="#"><span class="glyphicon glyphicon-remove"></span></a>                                        
                                            </p>
                                        </td>
                                    </tr>                               
                                </tbody>
                            </table>
                        </div>
                    </div>            

                </div>                            

            </div>

        </div>   
    </div>

    <div class="modal fade" id="dModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>                        
                    <h4>Оплата за тех обслуживание двора</h4>
                </div>
                <div class="modal-body">
                    <h5>
                        QR - code для сканирование и оплаты
                    </h5>
                    <img src="https://upload.wikimedia.org/wikipedia/commons/d/d0/QR_code_for_mobile_English_Wikipedia.svg" class="img-thumbnail" style="width: 100%;">
                </div>                    
            </div>
        </div>
    </div>

{% endblock %}
    
